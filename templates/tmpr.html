{% macro watch(title, id, value, unit='', default='<b>??</b>') -%}
    <tr>
        <td>{{ title }}</td>
        <td id="{{ id }}" class="align_right large">
        {% if value %}
            {{ value }}
        {% else %}
            {{ default|safe }}
        {% endif %}
        </td>
        <td>{{ unit }}</td>
    </tr>
{%- endmacro %}
<!doctype html>
<html>
<head>
<title>Hello, {% if master_mind %}Master{% else %}World{% endif %} — Temperature Controller</title>
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<link rel="mask-icon" href="{{ url_for('static', filename='safari-pinned-tab.svg') }}" color="#5bbad5">
<meta name="theme-color" content="#ffffff">
<script type=text/javascript src="{{ url_for('static', filename='jquery-3.2.1.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='temperature_controller.css') }}">
<script src="{{ url_for('static', filename='amcharts/amcharts.js') }}"></script>
<script src="{{ url_for('static', filename='amcharts/serial.js') }}"></script>
<script src="{{ url_for('static', filename='amcharts/plugins/export/export.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='amcharts/plugins/export/export.css') }}" type="text/css" media="all" />
<script src="{{ url_for('static', filename='amcharts/themes/light.js') }}"></script>
<script type="text/javascript">
"use strict";
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires=" + d.toGMTString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for (var i = 0; i < ca.length; ++i) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

function loadSettings() {
    var saveData = getCookie("save_data");
    if (saveData.toString() == 'true') {
        $("#discard_data").prop('checked', false);
    }
    else {
        $("#discard_data").prop('checked', true);
    }
{% if master_mind -%}
    var i;
    for (var output = 1; output <= 2; ++output) {
        i = getCookie("input" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " select#input_list")[0].value = i;
        }
        i = getCookie("pid_mode" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " select#pid_mode_list")[0].value = i;
        }
        i = getCookie("powerup" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " select#powerup_list")[0].value = i;
        }
        i = getCookie("pid_range" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " select#pid_range_list")[0].value = i;
        }
        i = getCookie("pid_value" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " input#pid_value_field")[0].value = i;
        }
        i = getCookie("pid_p" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " input#pid_p_field")[0].value = i;
        }
        i = getCookie("pid_i" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " input#pid_i_field")[0].value = i;
        }
        i = getCookie("pid_d" + output);
        if (i !== "") {
            $("table#pid_ch" + output + " input#pid_d_field")[0].value = i;
        }
        i = getCookie("rtm_input");
        if (i !== "") {
            $("table#rtm select#input_list")[0].value = i;
        }
        i = getCookie("rtm_count");
        if (i !== "") {
            $("table#rtm input#count_field")[0].value = i;
        }
    }
{%- endif %}
}
</script>
<script type=text/javascript>
var plotData = [];
var chart = AmCharts.makeChart("chart", {
  "type": "serial",
  //"theme": "light",
  "marginRight": 40,
  "marginLeft": 40,
  "autoMarginOffset": 20,
  "valueAxes": [{
    "id": "temperature",
    "position": "left",
    "ignoreAxisWidth": true,
    "precision": 2,
    "minPeriod": 0.001,
    "includeAllValues": true,
    "unit": "K"
  }],
  "balloon": {
    "borderThickness": 1,
    "shadowAlpha": 0
  },
  "graphs": [{
    "id": "temperatureA",
    "balloon": {
      "drop": true,
      "animationDuration": 0
    },
    "bullet": "none",
    "lineThickness": 2,
    "valueField": "temperature1",
    "balloonText": "<span style='font-size:18px;'>[[value]] K</span>"
  },
  {
    "id": "temperatureB",
    "balloon": {
      "drop": true,
      "animationDuration": 0
    },
    "bullet": "none",
    "lineThickness": 2,
    "valueField": "temperature2",
    "balloonText": "<span style='font-size:18px;'>[[value]] K</span>"
  }],
  "chartScrollbar": {
    "oppositeAxis": false,
    "offset": 30,
    "scrollbarHeight": 10,
    "autoGridCount": true,
    "color": "transparent",
    "updateOnReleaseOnly": true
  },
  "chartCursor": {
    "pan": true,
    "valueLineEnabled": true,
    "valueLineBalloonEnabled": true,
    "cursorAlpha": 1,
    "cursorColor": "#258cbb",
    "valueLineAlpha": 0.2,
    "valueZoomable": true,
    "categoryBalloonDateFormat": "HH:NN:SS",
    "animationDuration": 0
  },
  "valueScrollbar": {
    "oppositeAxis": false,
    "offset": 78,
    "scrollbarHeight": 10
  },
  "categoryField": "time",
  "categoryAxis": {
    "parseDates": true,
    "dashLength": 1,
    "minorGridEnabled": true,
    "autoGridCount": true,
    "minPeriod": "fff"
  },
  "dataProvider": [],
  "export": {
    "enabled": true,
    "libs": {
      "path": "{{ url_for('static', filename='amcharts/plugins/export/libs/') }}"
    },
    "menu": [{
    "class": "export-main",
    "label": "Export",
    "menu": [
/*      {
        "label": "Download as …",
        "menu": [{
          "format": "PNG",
          "label": "PNG"
        }, {
          "format": "SVG",
          "label": "SVG"
        }, {
          "format": "PDF",
          "label": "PDF"
        }]
      },*/ {
        "label": "Save as …",
        "menu": [{
          "label": "CSV as time stamps",
          "click": function() {
              this.toCSV({
                data: plotData,
                dateFormat: "JJ:NN:SS"
              }, function(data) {
                this.download(data, this.defaults.formats.CSV.mimeType, "temperature.csv");
              });
            }
        }, {
          "label": "CSV as intervals",
          "click": function() {
              var revData = plotData;
              var firstTime = null;
              var timeKeyName = "time";
              var i;
              for (i = 0; i < revData.length; i += 1) {
                  if (revData[i][timeKeyName] !== null) {
                      if (firstTime !== null) {
                    revData[i][timeKeyName] = 0.001 * (+revData[i][timeKeyName] - firstTime);
                  }
                  else {
                    firstTime = +revData[i][timeKeyName];
                    revData[i][timeKeyName] = 0;
                  }
                }
              }
              this.toCSV({
                data: revData,
              }, function(data) {
                this.download(data, this.defaults.formats.CSV.mimeType, "temperature.csv");
              });
            }
        }, {
          "label": "XLSX as time stamps",
          "click": function() {
              this.toXLSX({
                data: plotData,
                dateFormat: "JJ:NN:SS"
              }, function(data) {
                this.download(data, this.defaults.formats.XLSX.mimeType, "temperature.xlsx");
              });
            }
        }, {
          "label": "XLSX as intervals",
          "click": function() {
              var revData = plotData;
              var firstTime = null;
              var timeKeyName = "time";
              var i;
              for (i = 0; i < revData.length; i += 1) {
                if (revData[i][timeKeyName] !== null) {
                  if (firstTime !== null) {
                    revData[i][timeKeyName] = 0.001 * (+revData[i][timeKeyName] - firstTime);
                  }
                  else {
                    firstTime = +revData[i][timeKeyName];
                    revData[i][timeKeyName] = 0;
                  }
                }
              }
              this.toXLSX({
                data: revData,
              }, function(data) {
                this.download(data, this.defaults.formats.XLSX.mimeType, "temperature.xlsx");
              });
            }
        }]
      }, {
        "label": "Annotate …",
        "action": "draw"
      }, {
        "label": "Print",
        "format": "PRINT"
      }]
    }]
  }
});
chart.isZoomed = false;
chart.ignoreZoomed = true;
chart.addListener("zoomed", function(event) {
    if (chart.ignoreZoomed) {
        chart.ignoreZoomed = false;
        return;
    }
    chart.isZoomed = (event.endIndex - event.startIndex < event.chart.dataProvider.length - 1);
    chart.zoomStart = event.startIndex;
    chart.zoomEnd = event.endIndex;
});

chart.addListener("dataUpdated", function(event) {
    if (!chart.isZoomed) {
        return;
    }
    chart.zoomToIndexes(chart.zoomStart + 1, chart.zoomEnd + 2);
});
/******************************************************************************/
var timePeriod = 500;
var lastRequestTime = new Date();
var lastResponseTime = new Date();
var lastReplotTime = new Date();
function update_values() {
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    var now = new Date();
    if (now - lastRequestTime < 0.9 * timePeriod || now - lastResponseTime < 0.9 * timePeriod) {
        return;
    }
    lastRequestTime = now;
    $.getJSON($SCRIPT_ROOT+"/temperature_controller/json",
        function(data) {
            var i;
            now = new Date();
            if (now - lastResponseTime < 0.9 * timePeriod) {
                return;
            }
            lastResponseTime = now;

            var dict = {};
            var in_ok = false;
            if (data.rtm) {
                $("div#rtm").show();
            }
            else {
                $("div#rtm").hide();
            }
            if (data.temperatures != null) {
                var key;
                for (i = 0; i < 2; i += 1) {
                    dict["time"] = new Date();
                    if (data.temperatures[i] !== "None" &&
                        data.temperatures[i] !== "" &&
                        data.temperatures[i] !== null) {
                            $("#temperature" + (i+1)).text(data.temperatures[i]);
                            key = "temperature" + (i+1);
                            dict[key] = data.temperatures[i];
                            in_ok = true;
                            {% if master_mind -%}
                                $($("table#pid_ch1 select#input_list option")[i+1]).show();
                                $($("table#pid_ch2 select#input_list option")[i+1]).show();
                                $("table#rtm").show();
                            {%- endif %}
                    }
                    else {
                        $("#temperature" + (i+1)).html("<b>??</b>");
                        {% if master_mind -%}
                            $($("table#pid_ch1 select#input_list option")[i+1]).hide();
                            if ($($("table#pid_ch1 select#input_list")[0]).selectedIndex === i+1) {
                                $($("table#pid_ch1 select#input_list")[0]).selectedIndex = 0;
                            }
                            $($("table#pid_ch2 select#input_list option")[i+1]).hide();
                            if ($($("table#pid_ch2 select#input_list")[0]).selectedIndex === i+1) {
                                $($("table#pid_ch2 select#input_list")[0]).selectedIndex = 0;
                            }
                            $("table#rtm").hide();
                        {%- endif %}
                    }
                }
            }
            else {
                for (i = 0; i < 2; i += 1) {
                    $("#temperature" + (i+1)).html("<b>??</b>");
                    {% if master_mind -%}
                        $($("table#pid_ch1 select#input_list option")[i+1]).hide();
                        if ($($("table#pid_ch1 select#input_list")[0]).selectedIndex === i+1) {
                            $($("table#pid_ch1 select#input_list")[0]).selectedIndex = 0;
                        }
                        $($("table#pid_ch2 select#input_list option")[i+1]).hide();
                        if ($($("table#pid_ch2 select#input_list")[0]).selectedIndex === i+1) {
                            $($("table#pid_ch2 select#input_list")[0]).selectedIndex = 0;
                        }
                    {%- endif %}
                }
                {% if master_mind -%}
                    $("table#rtm").hide();
                {%- endif %}
                dict = {};
            }
            if (Object.keys(dict).length > 1) {
                if (!$("#discard_data").prop("checked")) {
                    plotData.push(dict);
                    var maxLength = 200;
                    var displayedLength = 0;
                    for (i = 0; i < plotData.length; i += 1) {
                        if (plotData[i].time >= chart.chartScrollbar.startTime &&
                            plotData[i].time <= chart.chartScrollbar.endTime) {
                            displayedLength += 1;
                        }
                    }
                    if (displayedLength > maxLength) {
                        chart.dataProvider = [];
                        var denom = displayedLength / maxLength;
                        for (i = 0; Math.round(i) < plotData.length; i += denom) {
                            chart.dataProvider.push(plotData[Math.round(i)]);
                        }
                    }
                    else {
                        chart.dataProvider.push(dict);
                    }
                    chart.ignoreZoomed = true;
                    if (+now > +lastReplotTime + 1000) {
                        lastReplotTime = now;
                        chart.validateData();
                        setCookie("save_data", true, 30);
                    }
                }
                else {
                    if (+now > +lastReplotTime + 1000) {
                        lastReplotTime = now;
                        setCookie("save_data", false, 30);
                    }
                }
            }
            if (in_ok) {
                $("input#discard_data + label").show();
            }
            else {
                $("input#discard_data + label").hide();
            }

            if (data.output !== null) {
                for (i = 0; i < 2; i += 1) {
                    if (data.output[i] !== "None" &&
                        data.output[i] !== "" &&
                        data.output[i] !== null) {
                            $("#output" + (i+1)).text(data.output[i]);
                            {% if master_mind -%}
                                $("table#pid_ch" + (i+1)).show();
                            {%- endif %}
                    }
                    else {
                        $("#output" + (i+1)).html("<b>??</b>");
                        {% if master_mind -%}
                            $("table#pid_ch" + (i+1)).hide();
                        {%- endif %}
                    }
                }
            }
            else {
                for (i = 0; i < 2; i += 1) {
                    $("#output" + (i+1)).html("<b>??</b>");
                    {% if master_mind -%}
                        $("table#pid_ch" + (i+1)).hide();
                    {%- endif %}
                }
            }
        });
    if (plotData.length === 0) {
        $("div#chart").hide();
    }
    else if (plotData.length === 1) {        // to fire only once
        $("div#chart").show();
        $("input#clear").show();
    }
}
setInterval(update_values, timePeriod);
$(document).ready(function() {
    $("input#clear").click(function() {
        chart.dataProvider = [];
        plotData = [];
        chart.validateData();
        $("input#clear").hide();
    });
});
</script>
{% if master_mind -%}
<script type="text/javascript">
function pid_on(output) {
    if ($($("table#pid_ch" + output)[0]).is(':hidden')) {
        alert("Invalid output");
        return;
    }
    var input_list = $("table#pid_ch" + output + " select#input_list")[0];
    var input = input_list.options[input_list.selectedIndex].value;
    if ($($("table#pid_ch" + output + " select#input_list option")[input_list.selectedIndex]).is(':hidden')) {
        alert("Invalid input");
        return;
    }
    var pid_mode_list = $("table#pid_ch" + output + " select#pid_mode_list")[0];
    var pid_mode = pid_mode_list.options[pid_mode_list.selectedIndex].value;
    var powerup_list = $("table#pid_ch" + output + " select#powerup_list")[0];
    var powerup = powerup_list.options[powerup_list.selectedIndex].value;
    var pid_range_list = $("table#pid_ch" + output + " select#pid_range_list")[0];
    var pid_range = pid_range_list.options[pid_range_list.selectedIndex].value;
    var pid_value_field = $("table#pid_ch" + output + " input#pid_value_field")[0];
    var pid_value = pid_value_field.value;
    var pid_p_field = $("table#pid_ch" + output + " input#pid_p_field")[0];
    var pid_p = pid_p_field.value;
    var pid_i_field = $("table#pid_ch" + output + " input#pid_i_field")[0];
    var pid_i = pid_i_field.value;
    var pid_d_field = $("table#pid_ch" + output + " input#pid_d_field")[0];
    var pid_d = pid_d_field.value;
    $.ajax({
        type: 'post',
        url: '/temperature_controller/do',
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
          cmds:
          [
            {
              cmd: "outmode",
              payload:
              [
                /* output:         */   output,     // 1 or 2
                /* mode:           */   pid_mode,   // 0 = Off, 1 = Closed Loop PID, 2 = Zone, 3 = Open Loop, 4 = Monitor Out, 5 = Warmup Supply
                /* input:          */   input,      // 0 = None, 1 = A, 2 = B
                /* powerup_enable: */   powerup     // 0 = Off, 1 = On
              ]
            },
            {
              cmd: "pid",
              payload:
              [
                /* output:         */   output,     // 1 or 2
                /* P:              */   pid_p,      // Proportional (gain)
                /* I:              */   pid_i,      // Integral (reset)
                /* D:              */   pid_d       // Derivative (rate)
              ]
            },
            {
              cmd: "setp",
              payload:
              [
                /* output:         */   output,     // 1 or 2
                /* value:          */   pid_value   // respect the sensor units!
              ]
            },
            {
              cmd: "range",
              payload:
              [
                /* output:         */   output,     // 1 or 2
                /* range:          */   pid_range   // 0 = Off, 1 = Low, 2 = Medium, 3 = High
              ]
            }
          ]
        }),
        success: function(data, status) {
            alert(data);
        }
    });
    setCookie("input" + output,     input, 30);
    setCookie("pid_mode" + output,  pid_mode, 30);
    setCookie("powerup" + output,   powerup, 30);
    setCookie("pid_range" + output, pid_range, 30);
    setCookie("pid_value" + output, pid_value, 30);
    setCookie("pid_p" + output,     pid_p, 30);
    setCookie("pid_i" + output,     pid_i, 30);
    setCookie("pid_d" + output,     pid_d, 30);
}
function pid_off(output) {
    $.ajax({
        type: 'post',
        url: '/temperature_controller/do',
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
          cmds:
          [
            {
              cmd: "outmode",
              payload:
              [
                /* output:         */   output,     // 1 or 2
                /* mode:           */   0,          // 0 = Off, 1 = Closed Loop PID, 2 = Zone, 3 = Open Loop, 4 = Monitor Out, 5 = Warmup Supply
                /* input:          */   0,          // 0 = None, 1 = A, 2 = B
                /* powerup_enable: */   0           // 0 = Off, 1 = On
              ]
            },
            {
              cmd: "range",
              payload:
              [
                /* output:         */   output,     // 1 or 2
                /* range:          */   0           // 0 = Off, 1 = Low, 2 = Medium, 3 = High
              ]
            }
          ]
        }),
        success: function(data, status) {
            alert(data);
        }
    });
}
</script>
<script type="text/javascript">
function rtm() {
    var input_list = $("table#rtm select#input_list")[0];
    var input = input_list.options[input_list.selectedIndex].value;
    var option = $("table#rtm select#input_list option")[input_list.selectedIndex];
    if ($(option).is(':hidden')) {
        alert("Invalid input");
        return;
    }
    var count_field = $("table#rtm input#count_field")[0];
    var count = count_field.value;
    $.ajax({
        type: 'post',
        url: '/temperature_controller/rtm',
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
          label: input,
          count: count
        }),
        success: function(data, status) {
            alert(data);
        }
    });
    setCookie("rtm_input", input, 30);
    setCookie("rtm_count", count, 30);
}
</script>
{%- endif %}
</head>
<body onload="loadSettings();">
<div id="rtm">Please wait until realtime measurements are over.</div>
<table class="state">
    <tr>
        <td>
            <table class="wide">
                {{ watch(title='Temperature A:', id='temperature1', value=temperatures[0], unit='K') }}
                {{ watch(title='Temperature B:', id='temperature2', value=temperatures[1], unit='K') }}
                {{ watch(title='Output 1:', id='output1', value=output[0], unit='%') }}
                {{ watch(title='Output 2:', id='output2', value=output[1], unit='%') }}
            </table>
        </td>
    </tr>
{% if master_mind -%}
    <tr>
        <td>
            <table class="wide" id="pid">
                <tr>
                    <td>
                        <table class="wide" id="pid_ch1">
                            <tr>
                                <td>Output:</td>
                                <td>
                                    <b>1</b>
                                </td>
                            </tr>
                            <tr>
                                <td>Input:</td>
                                <td>
                                    <select id="input_list">
                                        <option value="0">None</option>
                                        <option value="1" selected>A</option>
                                        <option value="2">B</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Mode:</td>
                                <td>
                                    <select id="pid_mode_list">
                                        <option value="0">Off</option>
                                        <option value="1" selected>Closed Loop PID</option>
                                        <option value="2">Zone</option>
                                        <option value="3">Open Loop</option>
                                        <option value="4">Monitor Out</option>
                                        <option value="5">Warmup Supply</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Range:</td>
                                <td>
                                    <select id="pid_range_list">
                                        <option value="0">Off</option>
                                        <option value="1">Low</option>
                                        <option value="2" selected>Medium</option>
                                        <option value="3">High</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Powerup:</td>
                                <td>
                                    <select id="powerup_list">
                                        <option value="0">Off</option>
                                        <option value="1" selected>On</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Desired value:</td>
                                <td>
                                    <input type='number' id="pid_value_field" value="292.73" step="0.01" min="0.00"/>
                                </td>
                            </tr>
                            <tr>
                                <td>P:</td>
                                <td>
                                    <input type='number' id="pid_p_field" value="50" step="any"/>
                                </td>
                            </tr>
                            <tr>
                                <td>I:</td>
                                <td>
                                    <input type='number' id="pid_i_field" value="20" step="any"/>
                                </td>
                            </tr>
                            <tr>
                                <td>D:</td>
                                <td>
                                    <input type='number' id="pid_d_field" value="0" step="any"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="align_center" colspan=2>
                                    <input type="button" class="action_button" onclick="pid_on(1)" value="Turn PID on!">
                                    <input type="button" class="action_button" onclick="pid_off(1)" value="Turn PID off!">
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <table class="wide" id="pid_ch2">
                            <tr>
                                <td>Output:</td>
                                <td>
                                    <b>2</b>
                                </td>
                            </tr>
                            <tr>
                                <td>Input:</td>
                                <td>
                                    <select id="input_list">
                                        <option value="0">None</option>
                                        <option value="1">A</option>
                                        <option value="2" selected>B</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Mode:</td>
                                <td>
                                    <select id="pid_mode_list">
                                        <option value="0">Off</option>
                                        <option value="1" selected>Closed Loop PID</option>
                                        <option value="2">Zone</option>
                                        <option value="3">Open Loop</option>
                                        <option value="4">Monitor Out</option>
                                        <option value="5">Warmup Supply</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Range:</td>
                                <td>
                                    <select id="pid_range_list">
                                        <option value="0">Off</option>
                                        <option value="1">Low</option>
                                        <option value="2" selected>Medium</option>
                                        <option value="3">High</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Powerup:</td>
                                <td>
                                    <select id="powerup_list">
                                        <option value="0">Off</option>
                                        <option value="1" selected>On</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Desired value:</td>
                                <td>
                                    <input type='number' id="pid_value_field" value="292.73" step="0.01" min="0.00"/>
                                </td>
                            </tr>
                            <tr>
                                <td>P:</td>
                                <td>
                                    <input type='number' id="pid_p_field" value="50" step="any"/>
                                </td>
                            </tr>
                            <tr>
                                <td>I:</td>
                                <td>
                                    <input type='number' id="pid_i_field" value="20" step="any"/>
                                </td>
                            </tr>
                            <tr>
                                <td>D:</td>
                                <td>
                                    <input type='number' id="pid_d_field" value="0" step="any"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="align_center" colspan=2>
                                    <input type="button" class="action_button" onclick="pid_on(2)" value="Turn PID on!">
                                    <input type="button" class="action_button" onclick="pid_off(2)" value="Turn PID off!">
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
{%- endif %}
    <tr>
        <td>
            <div id="chart"></div>
        </td>
    </tr>
    <tr>
        <td class="align_center">
            <table class="fixed centered">
                <tr>
                    <td>
                        <input type="checkbox" id="discard_data">
                        <label for="discard_data">Don't record temperatures</label>
                    </td>
                    <td>
                        <input type="button" id="clear" value="Clear Data">
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<audio preload="auto" id="warning">
    <source src="{{ url_for('static', filename='horse.ogg') }}" type="audio/ogg">
    <source src="{{ url_for('static', filename='horse.mp3') }}" type="audio/mpeg">
</audio>

{% if master_mind -%}
<table id="rtm" class="wide">
    <tr>
        <td>
            <input type="button" class="action_button" id="rtm" onclick="rtm()" value="Start realtime measurements">
        </td>
        <td>
            <select id="input_list">
                <option value="">None</option>
                <option value="A" selected>A</option>
                <option value="B">B</option>
            </select>
        </td>
        <td>
            <input type='number' id="count_field" value="13" step="1" min="1"/>
        </td>
    </tr>
    <tr>
        <td>
            <a href="/temperature_controller/rtm/csv" target="_blank"><input type="button" class="action_button" value="Show result as text"></a>
            <a href="/temperature_controller/rtm/json" target="_blank"><input type="button" class="action_button" value="Show result as JSON"></a>
        </td>
    </tr>
</table>
{%- endif %}
</body>
</html>

